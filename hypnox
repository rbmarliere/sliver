#!/usr/bin/env python3

import argparse
import logging
import src as hypnox

logging.basicConfig(format='hypnox: %(levelname)s: %(message)s',
                    level=logging.INFO)
description = '''
          _        _
     |_| \_/ |_) |\ | / \ \/
     | |  |  |   | \| \_/ /\\

       sub noctem sapientia
    '''

argp = argparse.ArgumentParser(formatter_class=argparse.RawTextHelpFormatter,
                               description=description)

sub_parsers = argp.add_subparsers(title="commands",
                                  dest="command",
                                  required=True)

predict_parser = sub_parsers.add_parser(
    "predict",
    help="use a trained model to predict the content of a tsv data file")
predict_parser.add_argument("-i",
                            "--input",
                            help="path to tsv data file to predict",
                            required=True)
predict_parser.add_argument("-m",
                            "--model",
                            help="name of the model to use",
                            required=True)
predict_parser.set_defaults(func=hypnox.model.predict)

replay_parser = sub_parsers.add_parser(
    "replay", help="use a trained model to replay a database")
replay_parser.add_argument("-u",
                           "--update-only",
                           help="replay only rows lacking",
                           action="store_true")
replay_parser.add_argument("-m",
                           "--model",
                           help="name of the model to use",
                           required=True)
replay_parser.add_argument("-t",
                           "--table",
                           help="name of the table to update",
                           required=True)
replay_parser.set_defaults(func=hypnox.db.replay)

stream_parser = sub_parsers.add_parser("stream",
                                       help="stream twitter in real time")
stream_parser.set_defaults(func=hypnox.stream.stream)

train_parser = sub_parsers.add_parser("train", help="train a model")
train_parser.add_argument("-m",
                          "--model",
                          help="name of the model to save",
                          required=True)
train_parser.set_defaults(func=hypnox.model.train)

args = argp.parse_args()
args.func(args)
